{"ast":null,"code":"var _jsxFileName = \"/Users/ashutoshnaruka/college-canteen-manager/client/src/context/AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useState, useContext, useEffect } from 'react';\nimport api from '../services/api';\nimport { initSocket, disconnectSocket, joinUserRoom, joinAdminRoom } from '../services/socket';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport const useAuth = () => {\n  _s();\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within AuthProvider');\n  }\n  return context;\n};\n_s(useAuth, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [cart, setCart] = useState([]);\n  useEffect(() => {\n    // Check if user is logged in\n    const storedUser = localStorage.getItem('user');\n    const accessToken = localStorage.getItem('accessToken');\n    if (storedUser && accessToken) {\n      const parsedUser = JSON.parse(storedUser);\n      setUser(parsedUser);\n\n      // Initialize socket\n      initSocket();\n\n      // Join appropriate room\n      if (parsedUser.role === 'admin' || parsedUser.role === 'staff') {\n        joinAdminRoom();\n      } else {\n        joinUserRoom(parsedUser.id);\n      }\n    }\n    setLoading(false);\n  }, []);\n  const login = async (email, password) => {\n    try {\n      const response = await api.post('/auth/login', {\n        email,\n        password\n      });\n      const {\n        user: userData,\n        accessToken,\n        refreshToken\n      } = response.data.data;\n      localStorage.setItem('user', JSON.stringify(userData));\n      localStorage.setItem('accessToken', accessToken);\n      localStorage.setItem('refreshToken', refreshToken);\n      setUser(userData);\n\n      // Initialize socket\n      initSocket();\n\n      // Join appropriate room\n      if (userData.role === 'admin' || userData.role === 'staff') {\n        joinAdminRoom();\n      } else {\n        joinUserRoom(userData.id);\n      }\n      return {\n        success: true\n      };\n    } catch (error) {\n      var _error$response, _error$response$data;\n      return {\n        success: false,\n        message: ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || 'Login failed'\n      };\n    }\n  };\n  const register = async (name, email, password) => {\n    try {\n      const response = await api.post('/auth/register', {\n        name,\n        email,\n        password\n      });\n      const {\n        user: userData,\n        accessToken,\n        refreshToken\n      } = response.data.data;\n      localStorage.setItem('user', JSON.stringify(userData));\n      localStorage.setItem('accessToken', accessToken);\n      localStorage.setItem('refreshToken', refreshToken);\n      setUser(userData);\n\n      // Initialize socket\n      initSocket();\n      joinUserRoom(userData.id);\n      return {\n        success: true\n      };\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n      return {\n        success: false,\n        message: ((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || 'Registration failed'\n      };\n    }\n  };\n  const logout = () => {\n    localStorage.removeItem('user');\n    localStorage.removeItem('accessToken');\n    localStorage.removeItem('refreshToken');\n    setUser(null);\n    setCart([]);\n    disconnectSocket();\n  };\n  const addToCart = item => {\n    setCart(prevCart => {\n      const existingItem = prevCart.find(cartItem => cartItem._id === item._id);\n      if (existingItem) {\n        return prevCart.map(cartItem => cartItem._id === item._id ? {\n          ...cartItem,\n          qty: cartItem.qty + 1\n        } : cartItem);\n      }\n      return [...prevCart, {\n        ...item,\n        qty: 1\n      }];\n    });\n  };\n  const removeFromCart = itemId => {\n    setCart(prevCart => prevCart.filter(item => item._id !== itemId));\n  };\n  const updateCartQty = (itemId, qty) => {\n    if (qty <= 0) {\n      removeFromCart(itemId);\n      return;\n    }\n    setCart(prevCart => prevCart.map(item => item._id === itemId ? {\n      ...item,\n      qty\n    } : item));\n  };\n  const clearCart = () => {\n    setCart([]);\n  };\n  const value = {\n    user,\n    loading,\n    login,\n    register,\n    logout,\n    cart,\n    addToCart,\n    removeFromCart,\n    updateCartQty,\n    clearCart\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 152,\n    columnNumber: 10\n  }, this);\n};\n_s2(AuthProvider, \"At1bG1A88UX3mjLUq19vKdRA5gk=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","api","initSocket","disconnectSocket","joinUserRoom","joinAdminRoom","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","context","Error","AuthProvider","children","_s2","user","setUser","loading","setLoading","cart","setCart","storedUser","localStorage","getItem","accessToken","parsedUser","JSON","parse","role","id","login","email","password","response","post","userData","refreshToken","data","setItem","stringify","success","error","_error$response","_error$response$data","message","register","name","_error$response2","_error$response2$data","logout","removeItem","addToCart","item","prevCart","existingItem","find","cartItem","_id","map","qty","removeFromCart","itemId","filter","updateCartQty","clearCart","value","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/ashutoshnaruka/college-canteen-manager/client/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\nimport api from '../services/api';\nimport { initSocket, disconnectSocket, joinUserRoom, joinAdminRoom } from '../services/socket';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within AuthProvider');\n  }\n  return context;\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [cart, setCart] = useState([]);\n\n  useEffect(() => {\n    // Check if user is logged in\n    const storedUser = localStorage.getItem('user');\n    const accessToken = localStorage.getItem('accessToken');\n\n    if (storedUser && accessToken) {\n      const parsedUser = JSON.parse(storedUser);\n      setUser(parsedUser);\n      \n      // Initialize socket\n      initSocket();\n      \n      // Join appropriate room\n      if (parsedUser.role === 'admin' || parsedUser.role === 'staff') {\n        joinAdminRoom();\n      } else {\n        joinUserRoom(parsedUser.id);\n      }\n    }\n    setLoading(false);\n  }, []);\n\n  const login = async (email, password) => {\n    try {\n      const response = await api.post('/auth/login', { email, password });\n      const { user: userData, accessToken, refreshToken } = response.data.data;\n\n      localStorage.setItem('user', JSON.stringify(userData));\n      localStorage.setItem('accessToken', accessToken);\n      localStorage.setItem('refreshToken', refreshToken);\n\n      setUser(userData);\n\n      // Initialize socket\n      initSocket();\n      \n      // Join appropriate room\n      if (userData.role === 'admin' || userData.role === 'staff') {\n        joinAdminRoom();\n      } else {\n        joinUserRoom(userData.id);\n      }\n\n      return { success: true };\n    } catch (error) {\n      return {\n        success: false,\n        message: error.response?.data?.message || 'Login failed'\n      };\n    }\n  };\n\n  const register = async (name, email, password) => {\n    try {\n      const response = await api.post('/auth/register', { name, email, password });\n      const { user: userData, accessToken, refreshToken } = response.data.data;\n\n      localStorage.setItem('user', JSON.stringify(userData));\n      localStorage.setItem('accessToken', accessToken);\n      localStorage.setItem('refreshToken', refreshToken);\n\n      setUser(userData);\n\n      // Initialize socket\n      initSocket();\n      joinUserRoom(userData.id);\n\n      return { success: true };\n    } catch (error) {\n      return {\n        success: false,\n        message: error.response?.data?.message || 'Registration failed'\n      };\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('user');\n    localStorage.removeItem('accessToken');\n    localStorage.removeItem('refreshToken');\n    setUser(null);\n    setCart([]);\n    disconnectSocket();\n  };\n\n  const addToCart = (item) => {\n    setCart((prevCart) => {\n      const existingItem = prevCart.find((cartItem) => cartItem._id === item._id);\n      if (existingItem) {\n        return prevCart.map((cartItem) =>\n          cartItem._id === item._id\n            ? { ...cartItem, qty: cartItem.qty + 1 }\n            : cartItem\n        );\n      }\n      return [...prevCart, { ...item, qty: 1 }];\n    });\n  };\n\n  const removeFromCart = (itemId) => {\n    setCart((prevCart) => prevCart.filter((item) => item._id !== itemId));\n  };\n\n  const updateCartQty = (itemId, qty) => {\n    if (qty <= 0) {\n      removeFromCart(itemId);\n      return;\n    }\n    setCart((prevCart) =>\n      prevCart.map((item) =>\n        item._id === itemId ? { ...item, qty } : item\n      )\n    );\n  };\n\n  const clearCart = () => {\n    setCart([]);\n  };\n\n  const value = {\n    user,\n    loading,\n    login,\n    register,\n    logout,\n    cart,\n    addToCart,\n    removeFromCart,\n    updateCartQty,\n    clearCart\n  };\n\n  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}